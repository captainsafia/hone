---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CodeBlock from '../components/CodeBlock.astro';

const features = [
  {
    title: 'Text Format',
    description: 'Simple, line-oriented DSL that\'s easy to read, write, and version control.'
  },
  {
    title: 'Real Shell',
    description: 'Commands run in actual shell sessions with persistent state and variables.'
  },
  {
    title: 'Rich Assertions',
    description: 'Assert on stdout, stderr, exit codes, files, timing, and regex patterns.'
  },
  {
    title: 'Single Binary',
    description: 'No runtime dependencies. Written in Rust for speed and reliability.'
  },
  {
    title: 'LSP Support',
    description: 'Built-in language server with completions, diagnostics, and hover docs.'
  },
  {
    title: 'Agent Friendly',
    description: 'Designed for AI agents to read, write, and understand test files.'
  },
];

const heroCode = `TEST "my CLI works"

RUN mycli init --name myproject
ASSERT exit_code == 0
ASSERT stdout contains "Project created"

RUN mycli build
ASSERT exit_code == 0
ASSERT file "dist/output.js" exists`;
---

<BaseLayout title="Home">
  <Header currentPath="/" />
  
  <main class="flex-1">
    <!-- Hero Section -->
    <section class="py-16 md:py-24">
      <div class="max-w-[720px] mx-auto px-6">
        <div class="mb-12">
          <h1 class="text-3xl md:text-4xl font-semibold tracking-tight mb-4 text-text">
            Integration testing for CLIs
          </h1>
          <p class="text-lg text-text-muted max-w-[480px] leading-relaxed">
            Write readable tests, run real commands, assert on output. Built for humans and AI agents.
          </p>
        </div>
        
        <div class="flex flex-wrap gap-3 mb-12">
          <a href="/docs/installation" class="btn-primary">
            Get Started
          </a>
          <a href="https://github.com/captainsafia/hone" target="_blank" rel="noopener noreferrer" class="btn-secondary">
            GitHub
          </a>
        </div>
        
        <CodeBlock code={heroCode} filename="test.hone" />
      </div>
    </section>
    
    <!-- Install Section -->
    <section class="py-12 border-t border-border">
      <div class="max-w-[720px] mx-auto px-6">
        <div class="flex flex-col md:flex-row md:items-center gap-6">
          <div class="md:w-1/3">
            <h2 class="text-lg font-medium text-text">Install</h2>
            <p class="text-sm text-text-muted">Single binary, no dependencies.</p>
          </div>
          <div class="md:flex-1">
            <div class="group relative font-mono text-sm rounded-lg bg-surface border border-border p-3 overflow-x-auto">
              <span class="text-green select-none">$ </span><span class="text-text-muted">curl https://i.safia.sh/captainsafia/hone/preview | sh</span>
              <button
                type="button"
                id="install-copy-btn"
                class="absolute top-1/2 -translate-y-1/2 right-2 p-1.5 rounded text-text-subtle hover:text-text hover:bg-surface-elevated opacity-0 group-hover:opacity-100 focus:opacity-100 transition-opacity duration-150"
                aria-label="Copy install command"
              >
                <svg class="copy-icon w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                <svg class="check-icon w-4 h-4 hidden text-green" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <script is:inline>
      const installBtn = document.getElementById('install-copy-btn');
      const installCmd = 'curl https://i.safia.sh/captainsafia/hone/preview | sh';
      installBtn.addEventListener('click', async () => {
        await navigator.clipboard.writeText(installCmd);
        const copyIcon = installBtn.querySelector('.copy-icon');
        const checkIcon = installBtn.querySelector('.check-icon');
        copyIcon.classList.add('hidden');
        checkIcon.classList.remove('hidden');
        setTimeout(() => {
          copyIcon.classList.remove('hidden');
          checkIcon.classList.add('hidden');
        }, 1500);
      });
    </script>
    
    <!-- Features Section -->
    <section class="py-16 border-t border-border">
      <div class="max-w-[720px] mx-auto px-6">
        <h2 class="text-xl font-semibold mb-2 text-text">Why Hone?</h2>
        <p class="text-text-muted mb-10">Built for developers who want simple, reliable CLI testing.</p>
        
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6">
          {features.map((feature) => (
            <div>
              <h3 class="font-medium mb-1 text-text">{feature.title}</h3>
              <p class="text-text-subtle text-sm leading-relaxed">{feature.description}</p>
            </div>
          ))}
        </div>
      </div>
    </section>
    
    <!-- How It Works Section -->
    <section class="py-16 border-t border-border">
      <div class="max-w-[720px] mx-auto px-6">
        <h2 class="text-xl font-semibold mb-10 text-text">How It Works</h2>
        
        <ol class="grid md:grid-cols-3 gap-8">
          <li class="flex md:block gap-4">
            <span class="text-text-subtle font-mono text-sm">01</span>
            <p class="text-sm text-text-muted">Write a <code class="text-accent">.hone</code> test file</p>
          </li>
          <li class="flex md:block gap-4">
            <span class="text-text-subtle font-mono text-sm">02</span>
            <p class="text-sm text-text-muted">Run <code class="text-accent">hone run tests/</code></p>
          </li>
          <li class="flex md:block gap-4">
            <span class="text-text-subtle font-mono text-sm">03</span>
            <p class="text-sm text-text-muted">Get clear pass/fail results</p>
          </li>
        </ol>
      </div>
    </section>
  </main>
  
  <Footer />
</BaseLayout>
